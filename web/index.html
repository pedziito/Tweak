<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tweak</title>
<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<style>
/* ── Reset & Base ── */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0e1a;--bg2:#0c1120;--bg3:#111827;--border:#1e293b;
  --cyan:#06b6d4;--cyan2:#0891b2;--cyan-glow:rgba(6,182,212,.15);
  --amber:#f59e0b;--green:#10b981;--red:#ef4444;--purple:#8b5cf6;
  --text:#f1f5f9;--text2:#94a3b8;--text3:#64748b;
  --sidebar-w:260px;--radius:14px;
}
html,body{height:100%;overflow:hidden;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text3)}

/* ── Layout ── */
#app{display:flex;height:100vh}
.sidebar{width:var(--sidebar-w);min-width:var(--sidebar-w);background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:20px 0;user-select:none}
.sidebar-brand{padding:0 24px 28px;display:flex;align-items:center;gap:12px}
.sidebar-brand .logo{width:36px;height:36px;background:linear-gradient(135deg,var(--cyan),var(--purple));border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;color:#fff}
.sidebar-brand h1{font-size:20px;font-weight:700;background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sidebar-brand span{font-size:11px;color:var(--text3);display:block;margin-top:2px;-webkit-text-fill-color:var(--text3)}
.nav-section{padding:0 16px;margin-bottom:6px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--text3)}
.nav-items{list-style:none;padding:0 10px;margin-bottom:20px}
.nav-items li{padding:10px 14px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:13.5px;font-weight:500;color:var(--text2);transition:all .2s}
.nav-items li:hover{background:rgba(255,255,255,.04);color:var(--text)}
.nav-items li.active{background:var(--cyan-glow);color:var(--cyan);font-weight:600}
.nav-items li .icon{width:20px;text-align:center;font-size:15px;flex-shrink:0}
.nav-items li .badge{margin-left:auto;background:var(--cyan);color:#000;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px}
.sidebar-footer{margin-top:auto;padding:16px 20px;border-top:1px solid var(--border)}
.admin-badge{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.admin-badge.is-admin{background:rgba(16,185,129,.12);color:var(--green)}
.admin-badge.not-admin{background:rgba(239,68,68,.12);color:var(--red)}
.admin-badge:hover{filter:brightness(1.2)}

/* ── Main Area ── */
.main{flex:1;overflow-y:auto;padding:28px 32px}
.page-header{margin-bottom:24px}
.page-header h2{font-size:26px;font-weight:700;margin-bottom:4px}
.page-header p{color:var(--text2);font-size:14px}

/* ── Cards ── */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:20px;transition:all .25s}
.card:hover{border-color:rgba(6,182,212,.25);box-shadow:0 0 20px rgba(6,182,212,.06)}
.card-title{font-size:13px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:14px}

/* ── Grid helpers ── */
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
@media(max-width:1200px){.grid-4{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(2,1fr)}}

/* ── Stat Cards ── */
.stat-card{text-align:center;padding:24px 16px}
.stat-card .value{font-size:32px;font-weight:800;background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-card .label{font-size:12px;color:var(--text3);margin-top:4px}

/* ── Score Ring ── */
.score-ring{position:relative;width:140px;height:140px;margin:0 auto 12px}
.score-ring svg{width:100%;height:100%;transform:rotate(-90deg)}
.score-ring .bg{fill:none;stroke:var(--border);stroke-width:8}
.score-ring .fg{fill:none;stroke:var(--cyan);stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset .8s ease}
.score-ring .val{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:var(--cyan)}
.score-label{text-align:center;font-size:14px;font-weight:600;color:var(--text2)}

/* ── Monitor Bars ── */
.monitor-bar{margin-bottom:16px}
.monitor-bar .bar-header{display:flex;justify-content:space-between;margin-bottom:6px;font-size:13px}
.monitor-bar .bar-header .name{color:var(--text2)}
.monitor-bar .bar-header .pct{color:var(--cyan);font-weight:700}
.monitor-bar .track{height:6px;background:var(--bg);border-radius:3px;overflow:hidden}
.monitor-bar .fill{height:100%;border-radius:3px;transition:width .5s ease;background:linear-gradient(90deg,var(--cyan),var(--purple))}

/* ── Hardware Info ── */
.hw-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px}
.hw-row:last-child{border-bottom:none}
.hw-row .hw-label{color:var(--text3)}
.hw-row .hw-value{color:var(--text);font-weight:600;text-align:right;max-width:60%}

/* ── Tweaks Page ── */
.filter-bar{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.search-box{flex:1;min-width:200px;padding:10px 16px;border-radius:10px;border:1px solid var(--border);background:var(--bg3);color:var(--text);font-size:14px;outline:none;transition:border-color .2s}
.search-box:focus{border-color:var(--cyan)}
.search-box::placeholder{color:var(--text3)}
.cat-btn{padding:8px 16px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:12.5px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.cat-btn:hover{border-color:var(--cyan);color:var(--text)}
.cat-btn.active{background:var(--cyan);color:#000;border-color:var(--cyan)}
.cat-count{margin-left:5px;opacity:.7}

.tweak-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px}
.tweak-card{display:flex;flex-direction:column;padding:18px 20px;min-height:140px}
.tweak-card .tc-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.tweak-card .tc-name{font-size:14.5px;font-weight:700;color:var(--text);flex:1;margin-right:10px}
.tweak-card .tc-desc{font-size:12.5px;color:var(--text3);line-height:1.5;flex:1}
.tweak-card .tc-bottom{display:flex;align-items:center;gap:8px;margin-top:auto;padding-top:12px}
.tweak-card .tc-badge{font-size:10px;font-weight:700;padding:3px 8px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px}
.tweak-card .tc-badge.rec{background:rgba(16,185,129,.12);color:var(--green)}
.tweak-card .tc-badge.risk-low{background:rgba(6,182,212,.12);color:var(--cyan)}
.tweak-card .tc-badge.risk-medium{background:rgba(245,158,11,.12);color:var(--amber)}
.tweak-card .tc-badge.risk-high{background:rgba(239,68,68,.12);color:var(--red)}

/* Toggle Switch */
.toggle{position:relative;width:44px;height:24px;flex-shrink:0;cursor:pointer}
.toggle input{display:none}
.toggle .slider{position:absolute;inset:0;background:var(--bg);border:1px solid var(--border);border-radius:12px;transition:all .3s}
.toggle .slider::before{content:'';position:absolute;width:18px;height:18px;left:2px;top:2px;background:var(--text3);border-radius:50%;transition:all .3s}
.toggle input:checked+.slider{background:var(--cyan);border-color:var(--cyan)}
.toggle input:checked+.slider::before{transform:translateX(20px);background:#fff}

/* ── Action Buttons ── */
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;border:none;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.btn-cyan{background:var(--cyan);color:#000}.btn-cyan:hover{background:var(--cyan2)}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text2)}.btn-outline:hover{border-color:var(--cyan);color:var(--cyan)}
.btn-red{background:rgba(239,68,68,.15);color:var(--red);border:1px solid rgba(239,68,68,.25)}.btn-red:hover{background:rgba(239,68,68,.25)}
.btn-green{background:rgba(16,185,129,.15);color:var(--green);border:1px solid rgba(16,185,129,.25)}.btn-green:hover{background:rgba(16,185,129,.25)}

/* ── Batch Popup ── */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:999}
.batch-popup{background:var(--bg2);border:1px solid var(--border);border-radius:18px;padding:32px;width:520px;max-height:80vh;overflow-y:auto}
.batch-popup h3{font-size:18px;font-weight:700;margin-bottom:16px}
.batch-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.batch-item:last-child{border-bottom:none}
.batch-item .bi-icon{width:20px;text-align:center;font-size:14px}
.batch-item .bi-icon.done{color:var(--green)}
.batch-item .bi-icon.active{color:var(--cyan);animation:pulse 1s infinite}
.batch-item .bi-icon.pending{color:var(--text3)}
.batch-item .bi-name{flex:1;color:var(--text)}
.batch-item .bi-status{font-size:11px;font-weight:600;text-transform:uppercase}
.progress-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden;margin:16px 0}
.progress-bar .fill{height:100%;background:linear-gradient(90deg,var(--cyan),var(--green));border-radius:3px;transition:width .3s}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* ── Quick Actions ── */
.quick-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.qa-btn{padding:14px;border-radius:12px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-align:center}
.qa-btn:hover{border-color:var(--cyan);color:var(--cyan);background:var(--cyan-glow)}

/* ── Boost Page ── */
.boost-card{padding:28px;text-align:center}
.boost-card .boost-icon{font-size:40px;margin-bottom:12px}
.boost-card h3{font-size:16px;font-weight:700;margin-bottom:6px}
.boost-card p{font-size:13px;color:var(--text3);margin-bottom:16px}

/* ── Settings ── */
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border)}
.setting-row:last-child{border-bottom:none}
.setting-row .sr-info h4{font-size:14px;font-weight:600;margin-bottom:2px}
.setting-row .sr-info p{font-size:12px;color:var(--text3)}

/* ── Score tier colors ── */
.score-s{color:var(--green)}.score-a{color:var(--cyan)}.score-b{color:var(--amber)}.score-c{color:var(--red)}

/* ── Toast notification ── */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:14px 22px;font-size:13px;font-weight:600;color:var(--cyan);z-index:1000;box-shadow:0 8px 32px rgba(0,0,0,.4);animation:slideUp .3s ease}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
</style>
</head>
<body>
<div id="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="logo">T</div>
      <div>
        <h1>Tweak</h1>
        <span>v5.0.0 &mdash; Vue Edition</span>
      </div>
    </div>

    <div class="nav-section">Menu</div>
    <ul class="nav-items">
      <li v-for="p in pages" :key="p.id" :class="{active:page===p.id}" @click="page=p.id">
        <span class="icon" v-html="p.icon"></span>
        {{p.label}}
        <span v-if="p.id==='tweaks' && appliedCount>0" class="badge">{{appliedCount}}</span>
      </li>
    </ul>

    <div class="nav-section">System</div>
    <ul class="nav-items">
      <li @click="page='settings'" :class="{active:page==='settings'}">
        <span class="icon">&#9881;</span> Settings
      </li>
    </ul>

    <div class="sidebar-footer">
      <div class="admin-badge" :class="isAdmin?'is-admin':'not-admin'" @click="!isAdmin && doRequestAdmin()">
        <span v-html="isAdmin ? '&#9989;' : '&#9888;'"></span>
        {{isAdmin ? 'Administrator' : 'Request Admin'}}
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">

    <!-- ═══════════ DASHBOARD ═══════════ -->
    <template v-if="page==='dashboard'">
      <div class="page-header">
        <h2>Dashboard</h2>
        <p>System overview and performance scoring</p>
      </div>

      <!-- Stat row -->
      <div class="grid-4" style="margin-bottom:20px">
        <div class="card stat-card">
          <div class="value">{{appliedCount}}</div>
          <div class="label">Tweaks Applied</div>
        </div>
        <div class="card stat-card">
          <div class="value">{{recommendedCount}}</div>
          <div class="label">Recommended</div>
        </div>
        <div class="card stat-card">
          <div class="value">{{tweaks.length}}</div>
          <div class="label">Total Tweaks</div>
        </div>
        <div class="card stat-card">
          <div class="value">{{categories.length}}</div>
          <div class="label">Categories</div>
        </div>
      </div>

      <div class="grid-3" style="margin-bottom:20px">
        <!-- Score Ring -->
        <div class="card" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px">
          <div class="card-title">Performance Score</div>
          <div class="score-ring">
            <svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="42"/>
              <circle class="fg" cx="50" cy="50" r="42"
                :stroke-dasharray="264"
                :stroke-dashoffset="264 - (264 * (scores.performanceScore||0) / 100)"/>
            </svg>
            <div class="val">{{scores.performanceScore||0}}</div>
          </div>
          <div class="score-label">Tier: <strong :class="'score-'+((scores.tier||'c').charAt(0).toLowerCase())">{{scores.tier||'?'}}</strong></div>
          <div v-if="scores.bottleneck" style="font-size:11px;color:var(--text3);margin-top:6px">Bottleneck: {{scores.bottleneck}}</div>
        </div>

        <!-- Monitor -->
        <div class="card">
          <div class="card-title">System Monitor</div>
          <div class="monitor-bar">
            <div class="bar-header"><span class="name">CPU</span><span class="pct">{{Math.round(monitor.cpuUsage||0)}}%</span></div>
            <div class="track"><div class="fill" :style="{width:Math.round(monitor.cpuUsage||0)+'%'}"></div></div>
          </div>
          <div class="monitor-bar">
            <div class="bar-header"><span class="name">RAM</span><span class="pct">{{Math.round(monitor.ramUsage||0)}}%</span></div>
            <div class="track"><div class="fill" :style="{width:Math.round(monitor.ramUsage||0)+'%'}"></div></div>
          </div>
          <div class="monitor-bar">
            <div class="bar-header"><span class="name">Storage</span><span class="pct">{{Math.round(monitor.storageUsage||0)}}%</span></div>
            <div class="track"><div class="fill" :style="{width:Math.round(monitor.storageUsage||0)+'%'}"></div></div>
          </div>
          <div style="font-size:12px;color:var(--text3);margin-top:8px">
            RAM: {{(monitor.ramUsedGb||0).toFixed(1)}} / {{(monitor.ramTotalGb||0).toFixed(1)}} GB &nbsp;|&nbsp; Uptime: {{monitor.uptimeText||'—'}}
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-title">Quick Actions</div>
          <div class="quick-actions">
            <div class="qa-btn" @click="doApplyRecommended">&#9889; Apply Recommended</div>
            <div class="qa-btn" @click="doRestoreAll">&#8634; Restore All</div>
            <div class="qa-btn" @click="doClearTemp">&#128465; Clear Temp</div>
            <div class="qa-btn" @click="doFlushDns">&#127760; Flush DNS</div>
            <div class="qa-btn" @click="doVerifyAll">&#9989; Verify All</div>
            <div class="qa-btn" @click="page='tweaks'">&#9881; All Tweaks</div>
          </div>
        </div>
      </div>

      <!-- Hardware -->
      <div class="card">
        <div class="card-title">Hardware Information</div>
        <div class="grid-2">
          <div>
            <div class="hw-row"><span class="hw-label">CPU</span><span class="hw-value">{{sysinfo.cpuName||'—'}}</span></div>
            <div class="hw-row"><span class="hw-label">Cores / Threads</span><span class="hw-value">{{sysinfo.cpuCores||'?'}} / {{sysinfo.cpuThreads||'?'}}</span></div>
            <div class="hw-row"><span class="hw-label">GPU</span><span class="hw-value">{{sysinfo.gpuName||'—'}}</span></div>
          </div>
          <div>
            <div class="hw-row"><span class="hw-label">RAM</span><span class="hw-value">{{sysinfo.ramText||'—'}}</span></div>
            <div class="hw-row"><span class="hw-label">Storage</span><span class="hw-value">{{sysinfo.storageText||'—'}}</span></div>
            <div class="hw-row"><span class="hw-label">OS</span><span class="hw-value">{{sysinfo.osVersion||'—'}}</span></div>
          </div>
        </div>
      </div>
    </template>

    <!-- ═══════════ TWEAKS PAGE ═══════════ -->
    <template v-if="page==='tweaks'">
      <div class="page-header" style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <h2>Optimizations</h2>
          <p>{{filteredTweaks.length}} tweaks &middot; {{appliedCount}} applied</p>
        </div>
        <div style="display:flex;gap:10px">
          <button class="btn btn-cyan" @click="startBatchApply" :disabled="unappliedVisible.length===0">
            &#9889; Apply Visible ({{unappliedVisible.length}})
          </button>
          <button class="btn btn-outline" @click="doRestoreAll">&#8634; Restore All</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="filter-bar">
        <input class="search-box" v-model="search" placeholder="&#128269; Search tweaks...">
        <button class="cat-btn" :class="{active:activeCat==='All'}" @click="activeCat='All'">All<span class="cat-count">{{tweaks.length}}</span></button>
        <button class="cat-btn" v-for="c in categories" :key="c" :class="{active:activeCat===c}" @click="activeCat=c">
          {{c}}<span class="cat-count">{{tweakCountByCat(c)}}</span>
        </button>
      </div>

      <!-- Tweak Cards -->
      <div class="tweak-grid">
        <div class="card tweak-card" v-for="t in filteredTweaks" :key="t.row">
          <div class="tc-top">
            <span class="tc-name">{{t.name}}</span>
            <label class="toggle" @click.stop>
              <input type="checkbox" :checked="t.applied" @change="toggleTweak(t.row)">
              <span class="slider"></span>
            </label>
          </div>
          <div class="tc-desc">{{t.description}}</div>
          <div class="tc-bottom">
            <span class="tc-badge" :class="'risk-'+t.risk">{{t.risk}}</span>
            <span v-if="t.recommended" class="tc-badge rec">&#9733; Recommended</span>
            <span v-if="t.requiresAdmin" style="font-size:10px;color:var(--amber)">&#128274; Admin</span>
            <span v-if="t.verified" style="font-size:10px;color:var(--green)">&#9989;</span>
          </div>
        </div>
      </div>

      <div v-if="filteredTweaks.length===0" style="text-align:center;padding:60px;color:var(--text3)">
        <div style="font-size:40px;margin-bottom:12px">&#128269;</div>
        <p>No tweaks match your search</p>
      </div>
    </template>

    <!-- ═══════════ BOOST PAGE ═══════════ -->
    <template v-if="page==='boost'">
      <div class="page-header">
        <h2>Boost Up</h2>
        <p>One-click optimization profiles for maximum performance</p>
      </div>

      <div class="grid-3" style="margin-bottom:20px">
        <div class="card boost-card">
          <div class="boost-icon">&#127918;</div>
          <h3>Gaming Boost</h3>
          <p>Apply all gaming-related optimizations for maximum FPS</p>
          <button class="btn btn-cyan" @click="doApplyGaming">Apply Gaming Tweaks</button>
        </div>
        <div class="card boost-card">
          <div class="boost-icon">&#9889;</div>
          <h3>Recommended</h3>
          <p>Apply all safe, recommended optimizations</p>
          <button class="btn btn-green" @click="doApplyRecommended">Apply Recommended</button>
        </div>
        <div class="card boost-card">
          <div class="boost-icon">&#128165;</div>
          <h3>Full Boost</h3>
          <p>Apply ALL available tweaks (advanced users only)</p>
          <button class="btn btn-red" @click="startFullBatchApply">Apply All Tweaks</button>
        </div>
      </div>

      <!-- Score Breakdown -->
      <div class="card" style="margin-bottom:20px">
        <div class="card-title">Score Breakdown</div>
        <div class="grid-4">
          <div style="text-align:center">
            <div style="font-size:28px;font-weight:800;color:var(--cyan)">{{scores.cpuScore||0}}</div>
            <div style="font-size:12px;color:var(--text3)">CPU Score</div>
          </div>
          <div style="text-align:center">
            <div style="font-size:28px;font-weight:800;color:var(--purple)">{{scores.gpuScore||0}}</div>
            <div style="font-size:12px;color:var(--text3)">GPU Score</div>
          </div>
          <div style="text-align:center">
            <div style="font-size:28px;font-weight:800;color:var(--green)">{{scores.ramScore||0}}</div>
            <div style="font-size:12px;color:var(--text3)">RAM Score</div>
          </div>
          <div style="text-align:center">
            <div style="font-size:28px;font-weight:800;color:var(--amber)">{{scores.storageScore||0}}</div>
            <div style="font-size:12px;color:var(--text3)">Storage Score</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Maintenance</div>
        <div class="quick-actions">
          <div class="qa-btn" @click="doClearTemp">&#128465; Clear Temp Files</div>
          <div class="qa-btn" @click="doFlushDns">&#127760; Flush DNS Cache</div>
          <div class="qa-btn" @click="doVerifyAll">&#9989; Verify All Tweaks</div>
          <div class="qa-btn" @click="doRestoreAll">&#8634; Restore Defaults</div>
        </div>
      </div>
    </template>

    <!-- ═══════════ GAMES PAGE ═══════════ -->
    <template v-if="page==='games'">
      <div class="page-header">
        <h2>Games</h2>
        <p>Game-specific optimization profiles</p>
      </div>

      <div class="grid-3">
        <div class="card boost-card" v-for="g in gameProfiles" :key="g.name">
          <div class="boost-icon">{{g.icon}}</div>
          <h3>{{g.name}}</h3>
          <p>{{g.desc}}</p>
          <button class="btn btn-outline" @click="applyGameProfile(g.cats)">Optimize for {{g.name}}</button>
        </div>
      </div>

      <div class="card" style="margin-top:20px">
        <div class="card-title">Applied Gaming Tweaks</div>
        <div v-if="appliedGamingTweaks.length===0" style="color:var(--text3);font-size:13px;padding:12px 0">No gaming tweaks applied yet</div>
        <div v-else>
          <div class="hw-row" v-for="t in appliedGamingTweaks" :key="t.row">
            <span class="hw-label">{{t.name}}</span>
            <span class="hw-value" style="color:var(--green)">&#9989; Active</span>
          </div>
        </div>
      </div>
    </template>

    <!-- ═══════════ SETTINGS ═══════════ -->
    <template v-if="page==='settings'">
      <div class="page-header">
        <h2>Settings</h2>
        <p>Application preferences and information</p>
      </div>

      <div class="card" style="margin-bottom:20px">
        <div class="card-title">General</div>
        <div class="setting-row">
          <div class="sr-info">
            <h4>Administrator Mode</h4>
            <p>{{isAdmin ? 'Running with elevated privileges' : 'Some tweaks require administrator rights'}}</p>
          </div>
          <button class="btn" :class="isAdmin?'btn-green':'btn-outline'" @click="!isAdmin && doRequestAdmin()">
            <span v-html="isAdmin ? '&#9989; Active' : 'Request Admin'"></span>
          </button>
        </div>
        <div class="setting-row">
          <div class="sr-info">
            <h4>Verify All Tweaks</h4>
            <p>Check the real system state of all applied tweaks</p>
          </div>
          <button class="btn btn-outline" @click="doVerifyAll">Verify</button>
        </div>
        <div class="setting-row">
          <div class="sr-info">
            <h4>Restore All Defaults</h4>
            <p>Undo every applied tweak and restore system defaults</p>
          </div>
          <button class="btn btn-red" @click="doRestoreAll">Restore</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">About</div>
        <div class="hw-row"><span class="hw-label">Version</span><span class="hw-value">5.0.0</span></div>
        <div class="hw-row"><span class="hw-label">Framework</span><span class="hw-value">Qt 6 + Vue.js 3</span></div>
        <div class="hw-row"><span class="hw-label">Engine</span><span class="hw-value">Qt WebEngine + WebChannel</span></div>
        <div class="hw-row"><span class="hw-label">Tweaks</span><span class="hw-value">{{tweaks.length}} available</span></div>
      </div>
    </template>

  </main>

  <!-- ═══════════ BATCH APPLY POPUP ═══════════ -->
  <div class="overlay" v-if="batchActive" @click.self="batchDone && closeBatch()">
    <div class="batch-popup">
      <h3 v-html="batchDone ? '&#9989; Complete!' : '&#9889; Applying Tweaks...'"></h3>
      <div class="progress-bar">
        <div class="fill" :style="{width: batchPct+'%'}"></div>
      </div>
      <div style="font-size:13px;color:var(--text2);margin-bottom:16px">
        {{batchCurrent}} / {{batchTotal}} tweaks
      </div>
      <div style="max-height:320px;overflow-y:auto">
        <div class="batch-item" v-for="(b,i) in batchItems" :key="i">
          <span class="bi-icon" :class="b.state">
            <span v-if="b.state==='done'">&#10003;</span>
            <span v-else-if="b.state==='active'">&#9679;</span>
            <span v-else>&#9675;</span>
          </span>
          <span class="bi-name">{{b.name}}</span>
          <span class="bi-status" :style="{color: b.state==='done'?'var(--green)':b.state==='active'?'var(--cyan)':'var(--text3)'}">
            {{b.state==='done'?'Done':b.state==='active'?'Applying...':'Pending'}}
          </span>
        </div>
      </div>
      <div style="margin-top:20px;text-align:right" v-if="batchDone">
        <button class="btn btn-cyan" @click="closeBatch">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" v-if="toastMsg" @click="toastMsg=''">{{toastMsg}}</div>
</div>

<script>
const {createApp, ref, computed, onMounted, reactive} = Vue;

const app = createApp({
  setup(){
    // ── State ──
    const bridge = ref(null);
    const page   = ref('dashboard');
    const search = ref('');
    const activeCat = ref('All');

    const sysinfo    = ref({});
    const monitor    = ref({});
    const scores     = ref({});
    const tweaks     = ref([]);
    const categories = ref([]);
    const isAdmin    = ref(false);
    const appliedCount = ref(0);
    const recommendedCount = ref(0);
    const toastMsg   = ref('');

    // Batch state
    const batchActive  = ref(false);
    const batchDone    = ref(false);
    const batchCurrent = ref(0);
    const batchTotal   = ref(0);
    const batchItems   = ref([]);
    const batchPct     = computed(()=> batchTotal.value ? Math.round(batchCurrent.value/batchTotal.value*100) : 0);

    // Pages
    const pages = [
      {id:'dashboard', label:'Dashboard',     icon:'&#9632;'},
      {id:'tweaks',    label:'Optimizations',  icon:'&#9881;'},
      {id:'boost',     label:'Boost Up',       icon:'&#9889;'},
      {id:'games',     label:'Games',          icon:'&#127918;'},
    ];

    // Game profiles
    const gameProfiles = [
      {name:'CS2',         icon:'\u{1F3AF}', desc:'Counter-Strike 2 \u2014 max FPS, low latency',        cats:['Gaming','Network']},
      {name:'Fortnite',    icon:'\u{1F3AE}', desc:'Fortnite \u2014 smooth builds, stable FPS',            cats:['Gaming','Network','Memory']},
      {name:'Valorant',    icon:'\u{1F52B}', desc:'Valorant \u2014 competitive edge, low input lag',      cats:['Gaming','Network','Power']},
      {name:'Apex Legends',icon:'\u{1F4A5}', desc:'Apex Legends \u2014 fast-paced battle royale boost',   cats:['Gaming','Network']},
      {name:'Minecraft',   icon:'\u26CF',    desc:'Minecraft \u2014 chunk loading, render distance',      cats:['Gaming','Memory','Storage']},
      {name:'General FPS', icon:'\u{1F31F}', desc:'Generic FPS optimization for any shooter',             cats:['Gaming','Network','Power','System']},
    ];

    // ── Computed ──
    const filteredTweaks = computed(()=>{
      let list = tweaks.value;
      if(activeCat.value!=='All') list = list.filter(t=>t.category===activeCat.value);
      if(search.value){
        const q = search.value.toLowerCase();
        list = list.filter(t=> t.name.toLowerCase().includes(q) || t.description.toLowerCase().includes(q) || t.category.toLowerCase().includes(q));
      }
      return list;
    });

    const unappliedVisible = computed(()=> filteredTweaks.value.filter(t=>!t.applied));
    const appliedGamingTweaks = computed(()=> tweaks.value.filter(t=>t.applied && t.category==='Gaming'));

    function tweakCountByCat(c){ return tweaks.value.filter(t=>t.category===c).length; }

    // ── Toast helper ──
    let toastTimer = null;
    function showToast(msg){
      toastMsg.value = msg;
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ toastMsg.value = ''; }, 3000);
    }

    // ── Data Loaders ──
    function refreshAll(){
      if(!bridge.value) return;
      bridge.value.getSystemInfo(function(d){ sysinfo.value = d; });
      bridge.value.getMonitorData(function(d){ monitor.value = d; });
      bridge.value.getScoreData(function(d){ scores.value = d; });
      bridge.value.getTweaks(function(d){ tweaks.value = d; });
      bridge.value.getCategories(function(d){ categories.value = d; });
      bridge.value.getAppliedCount(function(v){ appliedCount.value = v; });
      bridge.value.getRecommendedCount(function(v){ recommendedCount.value = v; });
      bridge.value.getIsAdmin(function(v){ isAdmin.value = v; });
    }

    function refreshTweaks(){
      if(!bridge.value) return;
      bridge.value.getTweaks(function(d){ tweaks.value = d; });
      bridge.value.getAppliedCount(function(v){ appliedCount.value = v; });
    }

    // ── Actions ──
    function toggleTweak(row){
      if(!bridge.value) return;
      bridge.value.toggleTweak(row);
    }
    function doApplyRecommended(){ if(bridge.value){ bridge.value.applyRecommended(); showToast('Applying recommended tweaks...'); }}
    function doApplyGaming(){ if(bridge.value){ bridge.value.applyAllGaming(); showToast('Applying gaming tweaks...'); }}
    function doRestoreAll(){ if(bridge.value){ bridge.value.restoreAll(); showToast('Restoring all defaults...'); }}
    function doClearTemp(){ if(bridge.value){ bridge.value.clearTempFiles(); showToast('Clearing temp files...'); }}
    function doFlushDns(){ if(bridge.value){ bridge.value.flushDns(); showToast('Flushing DNS cache...'); }}
    function doVerifyAll(){ if(bridge.value){ bridge.value.verifyAllTweaks(); showToast('Verifying all tweaks...'); }}
    function doRequestAdmin(){ if(bridge.value){ bridge.value.requestAdmin(); }}

    // Batch apply
    function startBatchApply(){
      var rows = unappliedVisible.value.map(function(t){ return t.row; });
      if(rows.length===0) return;
      runBatch(rows);
    }
    function startFullBatchApply(){
      var rows = tweaks.value.filter(function(t){ return !t.applied; }).map(function(t){ return t.row; });
      if(rows.length===0) return;
      runBatch(rows);
    }
    function runBatch(rows){
      batchActive.value = true;
      batchDone.value = false;
      batchCurrent.value = 0;
      batchTotal.value = rows.length;
      batchItems.value = rows.map(function(r){
        var tw = tweaks.value.find(function(t){ return t.row===r; });
        return {name: tw ? tw.name : 'Tweak #'+r, state:'pending'};
      });
      // Mark first as active
      if(batchItems.value.length > 0) batchItems.value[0].state = 'active';
      bridge.value.applyBatch(rows);
    }
    function closeBatch(){ batchActive.value = false; }
    function applyGameProfile(cats){
      var rows = tweaks.value.filter(function(t){ return !t.applied && cats.indexOf(t.category) >= 0; }).map(function(t){ return t.row; });
      if(rows.length===0){ showToast('All tweaks for this profile already applied!'); return; }
      runBatch(rows);
    }

    // ── Init ──
    onMounted(function(){
      new QWebChannel(qt.webChannelTransport, function(channel){
        bridge.value = channel.objects.bridge;

        // Signals
        bridge.value.tweaksChanged.connect(function(){ refreshTweaks(); });
        bridge.value.monitorUpdated.connect(function(){
          bridge.value.getMonitorData(function(d){ monitor.value = d; });
        });
        bridge.value.batchProgress.connect(function(cur, total, name, status){
          batchCurrent.value = cur;
          batchTotal.value = total;
          // Update items
          for(var i = 0; i < batchItems.value.length; i++){
            if(i < cur) batchItems.value[i].state = 'done';
            else if(i === cur) batchItems.value[i].state = 'active';
            else batchItems.value[i].state = 'pending';
          }
        });
        bridge.value.batchComplete.connect(function(){
          batchDone.value = true;
          batchCurrent.value = batchTotal.value;
          for(var i = 0; i < batchItems.value.length; i++){
            batchItems.value[i].state = 'done';
          }
          refreshTweaks();
        });

        // Initial load
        refreshAll();
      });
    });

    return {
      bridge, page, pages, search, activeCat,
      sysinfo, monitor, scores, tweaks, categories,
      isAdmin, appliedCount, recommendedCount,
      filteredTweaks, unappliedVisible, appliedGamingTweaks,
      tweakCountByCat,
      gameProfiles, toastMsg,
      toggleTweak, doApplyRecommended, doApplyGaming, doRestoreAll,
      doClearTemp, doFlushDns, doVerifyAll, doRequestAdmin,
      startBatchApply, startFullBatchApply, applyGameProfile, closeBatch,
      batchActive, batchDone, batchCurrent, batchTotal, batchItems, batchPct,
    };
  }
});

app.mount('#app');
</script>
</body>
</html>
